<!DOCTYPE html><html lang="jp" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>USB support to WSL2 | Memorandum!</title><meta name="author" content="ktkr3d"><meta name="copyright" content="ktkr3d"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="https:&#x2F;&#x2F;github.com&#x2F;rpasek&#x2F;usbip-wsl2-instructionshttps:&#x2F;&#x2F;github.com&#x2F;cezanne&#x2F;usbip-winhttps:&#x2F;&#x2F;snowstar.org&#x2F;2020&#x2F;06&#x2F;14&#x2F;wsl2-usb-via-usbip&#x2F;WSL のカーネルをカスタムしてUSB デバイスにアクセスしてみました。 $ uname -r -v4.19.104-micro">
<meta property="og:type" content="article">
<meta property="og:title" content="USB support to WSL2">
<meta property="og:url" content="https://ktkr3d.github.io/2020/07/06/USB-support-to-WSL2/index.html">
<meta property="og:site_name" content="Memorandum!">
<meta property="og:description" content="https:&#x2F;&#x2F;github.com&#x2F;rpasek&#x2F;usbip-wsl2-instructionshttps:&#x2F;&#x2F;github.com&#x2F;cezanne&#x2F;usbip-winhttps:&#x2F;&#x2F;snowstar.org&#x2F;2020&#x2F;06&#x2F;14&#x2F;wsl2-usb-via-usbip&#x2F;WSL のカーネルをカスタムしてUSB デバイスにアクセスしてみました。 $ uname -r -v4.19.104-micro">
<meta property="og:locale">
<meta property="og:image" content="https://assets.ubuntu.com/v1/29985a98-ubuntu-logo32.png">
<meta property="article:published_time" content="2020-07-06T09:20:40.000Z">
<meta property="article:modified_time" content="2020-07-06T09:20:40.000Z">
<meta property="article:author" content="ktkr3d">
<meta property="article:tag" content="usb">
<meta property="article:tag" content="wsl">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://assets.ubuntu.com/v1/29985a98-ubuntu-logo32.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "USB support to WSL2",
  "url": "https://ktkr3d.github.io/2020/07/06/USB-support-to-WSL2/",
  "image": "https://assets.ubuntu.com/v1/29985a98-ubuntu-logo32.png",
  "datePublished": "2020-07-06T09:20:40.000Z",
  "dateModified": "2020-07-06T09:20:40.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "ktkr3d",
      "url": "https://ktkr3d.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="/images/favicon.png"><link rel="canonical" href="https://ktkr3d.github.io/2020/07/06/USB-support-to-WSL2/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-MG6LWTJBY0"></script><script>window.dataLayer = window.dataLayer || []
function gtag(){dataLayer.push(arguments)}
gtag('js', new Date())
gtag('config', 'G-MG6LWTJBY0')
btf.addGlobalFn('pjaxComplete', () => {
  gtag('config', 'G-MG6LWTJBY0', {'page_path': window.location.pathname})
}, 'google_analytics')
</script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"pagination":{"enable":false,"hitsPerPage":8},"languages":{"hits_empty":"No results found for: ${query}","hits_stats":"${hits} articles found"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":false,"highlightLang":false,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'medium_zoom',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: false,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'USB support to WSL2',
  isHighlightShrink: undefined,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/css/custom.css"><script type="text/javascript" src="//www.google.com/jsapi"></script><meta name="generator" content="Hexo 8.1.1"><link rel="alternate" href="/rss.xml" title="Memorandum!" type="application/rss+xml">
</head><body><div class="bg-animation" id="web_bg" style="background-color: rgb(227, 233, 199);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/images/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">487</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">197</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">31</div></a></div><div class="menus_items"><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> Pages</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></li><li><a class="site-page child" href="/archlinux/"><i class="fa-fw fa-solid fa-a"></i><span> Arch Linux</span></a></li><li><a class="site-page child" href="/GNOME/"><i class="fa-fw fa-solid fa-g"></i><span> GNOME</span></a></li><li><a class="site-page child" href="/hexo/"><i class="fa-fw fa-solid fa-h"></i><span> Hexo</span></a></li><li><a class="site-page child" href="/To-Do/"><i class="fa-fw fa-solid fa-list"></i><span> To Do</span></a></li><li><a class="site-page child" href="/ubuntu/"><i class="fa-fw fa-brands fa-ubuntu"></i><span> Ubuntu</span></a></li><li><a class="site-page child" href="/Visual-Studio-Code/"><i class="fa-fw fa-solid fa-code"></i><span> Visual Studio Code</span></a></li><li><a class="site-page child" href="/World-of-Warcraft/"><i class="fa-fw fa-solid fa-gamepad"></i><span> World of Warcraft</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img fixed" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Memorandum!</span></a><a class="nav-page-title" href="/"><span class="site-name">USB support to WSL2</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  Back to Home</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></span></div><div class="menus_items"><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> Pages</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></li><li><a class="site-page child" href="/archlinux/"><i class="fa-fw fa-solid fa-a"></i><span> Arch Linux</span></a></li><li><a class="site-page child" href="/GNOME/"><i class="fa-fw fa-solid fa-g"></i><span> GNOME</span></a></li><li><a class="site-page child" href="/hexo/"><i class="fa-fw fa-solid fa-h"></i><span> Hexo</span></a></li><li><a class="site-page child" href="/To-Do/"><i class="fa-fw fa-solid fa-list"></i><span> To Do</span></a></li><li><a class="site-page child" href="/ubuntu/"><i class="fa-fw fa-brands fa-ubuntu"></i><span> Ubuntu</span></a></li><li><a class="site-page child" href="/Visual-Studio-Code/"><i class="fa-fw fa-solid fa-code"></i><span> Visual Studio Code</span></a></li><li><a class="site-page child" href="/World-of-Warcraft/"><i class="fa-fw fa-solid fa-gamepad"></i><span> World of Warcraft</span></a></li></ul></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">USB support to WSL2</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2020-07-06T09:20:40.000Z" title="Created 2020-07-06 18:20:40">2020-07-06</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2020-07-06T09:20:40.000Z" title="Updated 2020-07-06 18:20:40">2020-07-06</time></span></div><div class="meta-secondline"></div></div></div><article class="container post-content" id="article-container"><p><a target="_blank" rel="noopener" href="https://github.com/rpasek/usbip-wsl2-instructions">https://github.com/rpasek/usbip-wsl2-instructions</a><br><a target="_blank" rel="noopener" href="https://github.com/cezanne/usbip-win">https://github.com/cezanne/usbip-win</a><br><a target="_blank" rel="noopener" href="https://snowstar.org/2020/06/14/wsl2-usb-via-usbip/">https://snowstar.org/2020/06/14/wsl2-usb-via-usbip/</a><br>WSL のカーネルをカスタムしてUSB デバイスにアクセスしてみました。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">uname</span> -r -v</span><br><span class="line">4.19.104-microsoft-standard <span class="comment">#1 SMP Mon Jul 6 18:00:19 JST 2020</span></span><br><span class="line">$ lsusb</span><br><span class="line">Bus 002 Device 001: ID 1d6b:0003 Linux Foundation 3.0 root hub</span><br><span class="line">Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub</span><br></pre></td></tr></table></figure>

<span id="more"></span>

<h3 id="環境"><a href="#環境" class="headerlink" title="環境"></a>環境</h3><ul>
<li>セキュアブート無効</li>
<li>Windows 10 Insider Preview Build 20161<ul>
<li>usbip-win 0.3.0</li>
<li>WSL2 (Ubuntu 20.04 LTS)</li>
</ul>
</li>
</ul>
<h3 id="構築-Windows-10"><a href="#構築-Windows-10" class="headerlink" title="構築(Windows 10)"></a>構築(Windows 10)</h3><h4 id="USBIP-WIN-のインストール"><a href="#USBIP-WIN-のインストール" class="headerlink" title="USBIP-WIN のインストール"></a>USBIP-WIN のインストール</h4><ol>
<li>ファイルのダウンロード<br>  <a target="_blank" rel="noopener" href="https://github.com/cezanne/usbip-win/releases">https://github.com/cezanne/usbip-win/releases</a><br>  usbip-win 0.1.0 のAssets からダウンロード</li>
<li>証明書のインポート</li>
</ol>
<ul>
<li><code>usbip_test.pfx</code>をダブルクリック</li>
<li>パスワードは「usbip」</li>
<li>保存場所はローカルコンピュータ</li>
<li>以下の２つの証明書ストアに繰り返して配置<ul>
<li>信頼されたルート証明機関</li>
<li>信頼された発行元</li>
</ul>
</li>
</ul>
<ol start="3">
<li>テスト署名されたドライバーの読み込みの有効化</li>
</ol>
  <figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">&gt;bcdedit.exe /<span class="keyword">set</span> TESTSIGNING <span class="keyword">ON</span></span><br></pre></td></tr></table></figure>
<ol start="4">
<li>以下のメッセージが表示された場合はセキュアブートの無効化を実行する。</li>
</ol>
  <figure class="highlight"><table><tr><td class="code"><pre><span class="line">要素データ設定中にエラーが発生しました。</span><br><span class="line">この値はセキュアブートポリシーによって保護されているため、変更 または削除できません。</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>USB 一覧の表示と転送<br>  マスストレージデバイス(busid &#x3D; 1-112)の場合</li>
</ol>
  <figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">&gt;usbip.<span class="keyword">exe</span> <span class="keyword">list</span> -<span class="keyword">l</span></span><br><span class="line">- busid <span class="number">1</span>-<span class="number">112</span> (<span class="number">0</span><span class="keyword">bd</span><span class="variable">a:0169</span>)</span><br><span class="line">  Realtek Semiconductor Corp. : Mass Storage Device (<span class="number">0</span><span class="keyword">bd</span><span class="variable">a:0169</span>)</span><br><span class="line">&gt;usbip.<span class="keyword">exe</span> bind -<span class="keyword">b</span> <span class="number">1</span>-<span class="number">112</span></span><br><span class="line">usbip: info: bind_device: bind device <span class="keyword">on</span> busid <span class="number">1</span>-<span class="number">112</span>: <span class="built_in">complete</span></span><br><span class="line">&gt; usbipd.<span class="keyword">exe</span> -d -<span class="number">4</span></span><br></pre></td></tr></table></figure>
<ol start="6">
<li>ファイアウォールの許可(TCP port 3240)の問い合わせがあったら許可する。</li>
</ol>
<h3 id="構築-WSL"><a href="#構築-WSL" class="headerlink" title="構築(WSL)"></a>構築(WSL)</h3><h4 id="カーネルのビルド"><a href="#カーネルのビルド" class="headerlink" title="カーネルのビルド"></a>カーネルのビルド</h4><ol>
<li>ビルド用パッケージのインストールと現在のカーネルバージョンの確認</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">sudo</span> apt install build-essential flex bison libssl-dev libelf-dev libncurses-dev autoconf libudev-dev libtool</span><br><span class="line">$ <span class="built_in">uname</span> -r</span><br><span class="line">4.19.104-microsoft-standard</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>カーネルのソースコード取得</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">sudo</span> git <span class="built_in">clone</span> https://github.com/microsoft/WSL2-Linux-Kernel.git /usr/src/4.19.104-microsoft-standard</span><br><span class="line">$ <span class="built_in">cd</span> /usr/src/4.19.104-microsoft-standard</span><br><span class="line">$ <span class="built_in">sudo</span> git checkout v4.19.104</span><br><span class="line">$ <span class="built_in">sudo</span> <span class="built_in">cp</span> /proc/config.gz config.gz</span><br><span class="line">$ <span class="built_in">sudo</span> gunzip config.gz</span><br><span class="line">$ <span class="built_in">sudo</span> <span class="built_in">mv</span> config .config</span><br><span class="line">$ <span class="built_in">sudo</span> make menuconfig</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>オプション選択</li>
</ol>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line">Device Drivers<span class="punctuation">-&gt;</span>USB support[*]</span><br><span class="line">Device Drivers<span class="punctuation">-&gt;</span>USB support<span class="punctuation">-&gt;</span>Support <span class="keyword">for</span> <span class="title class_">Host</span>-side USB[M]</span><br><span class="line">Device Drivers<span class="punctuation">-&gt;</span>USB support<span class="punctuation">-&gt;</span>Enable USB persist by default[*]</span><br><span class="line">Device Drivers<span class="punctuation">-&gt;</span>USB support<span class="punctuation">-&gt;</span>USB <span class="title function_ invoke__">Modem</span> (CDC ACM) support[M]</span><br><span class="line">Device Drivers<span class="punctuation">-&gt;</span>USB support<span class="punctuation">-&gt;</span>USB Mass Storage support[M]</span><br><span class="line">Device Drivers<span class="punctuation">-&gt;</span>USB support<span class="punctuation">-&gt;</span>USB/IP support[M]</span><br><span class="line">Device Drivers<span class="punctuation">-&gt;</span>USB support<span class="punctuation">-&gt;</span>VHCI hcd[M]</span><br><span class="line">Device Drivers<span class="punctuation">-&gt;</span>USB support<span class="punctuation">-&gt;</span>VHCI hcd<span class="punctuation">-&gt;</span>Number of ports per USB/IP <span class="keyword">virtual</span> host <span class="title function_ invoke__">controller</span>(<span class="number">8</span>)</span><br><span class="line">Device Drivers<span class="punctuation">-&gt;</span>USB support<span class="punctuation">-&gt;</span>VHCI hcd<span class="punctuation">-&gt;</span>Number of USB/IP <span class="keyword">virtual</span> host <span class="title function_ invoke__">controllers</span>(<span class="number">1</span>)</span><br><span class="line">Device Drivers<span class="punctuation">-&gt;</span>USB support<span class="punctuation">-&gt;</span>USB Serial Converter support[M]</span><br><span class="line">Device Drivers<span class="punctuation">-&gt;</span>USB support<span class="punctuation">-&gt;</span>USB Serial Converter support<span class="punctuation">-&gt;</span>USB FTDI Single Port Serial Driver[M]</span><br><span class="line">Device Drivers<span class="punctuation">-&gt;</span>USB support<span class="punctuation">-&gt;</span>USB Physical Layer drivers<span class="punctuation">-&gt;</span>NOP USB Transceiver Driver[M]</span><br><span class="line">Device Drivers<span class="punctuation">-&gt;</span>Network device support<span class="punctuation">-&gt;</span>USB Network Adapters[M]</span><br><span class="line">Device Drivers<span class="punctuation">-&gt;</span>Network device support<span class="punctuation">-&gt;</span>USB Network Adapters<span class="punctuation">-&gt;</span>[Deselect everything you don<span class="symbol">&#x27;t</span> care about]</span><br><span class="line">Device Drivers<span class="punctuation">-&gt;</span>Network device support<span class="punctuation">-&gt;</span>USB Network Adapters<span class="punctuation">-&gt;</span>Multi-purpose USB Networking Framework[M]</span><br><span class="line">Device Drivers<span class="punctuation">-&gt;</span>Network device support<span class="punctuation">-&gt;</span>USB Network Adapters<span class="punctuation">-&gt;</span>CDC Ethernet <span class="title function_ invoke__">support</span> (smart devices such <span class="keyword">as</span> cable modems)[M]</span><br><span class="line">Device Drivers<span class="punctuation">-&gt;</span>Network device support<span class="punctuation">-&gt;</span>USB Network Adapters<span class="punctuation">-&gt;</span>Multi-purpose USB Networking Framework<span class="punctuation">-&gt;</span>Host <span class="keyword">for</span> <span class="title class_">RNDIS</span> and ActiveSync devices[M]</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>ビルド(6 多重で実行)</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> make -j 6 &amp;&amp; <span class="built_in">sudo</span> make modules_install -j 6 &amp;&amp; <span class="built_in">sudo</span> make install -j 6</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cd</span> tools/usb/usbip</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> ./autogen.sh</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> ./configure</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> sed <span class="string">&#x27;s/-Werror//g&#x27;</span> -i Makefile</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> sed <span class="string">&#x27;s/-Werror//g&#x27;</span> -i src/Makefile</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> sed <span class="string">&#x27;s/-Werror//g&#x27;</span> -i libsrc/Makefile</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> make install -j 6</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> <span class="built_in">cp</span> libsrc/.libs/libusbip.so.0 /lib/libusbip.so.0</span></span><br></pre></td></tr></table></figure>
<ol start="3">
<li>USB 有効化スクリプトの作成</li>
</ol>
<figure class="highlight bash"><figcaption><span>$HOME/startusb.sh</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">sudo</span> modprobe usbcore</span><br><span class="line"><span class="built_in">sudo</span> modprobe usb-common</span><br><span class="line"><span class="built_in">sudo</span> modprobe hid-generic</span><br><span class="line"><span class="built_in">sudo</span> modprobe hid</span><br><span class="line"><span class="built_in">sudo</span> modprobe usbnet</span><br><span class="line"><span class="built_in">sudo</span> modprobe cdc_ether</span><br><span class="line"><span class="built_in">sudo</span> modprobe rndis_host</span><br><span class="line"><span class="built_in">sudo</span> modprobe usbserial</span><br><span class="line"><span class="built_in">sudo</span> modprobe usb-storage</span><br><span class="line"><span class="built_in">sudo</span> modprobe cdc-acm</span><br><span class="line"><span class="built_in">sudo</span> modprobe ftdi_sio</span><br><span class="line"><span class="built_in">sudo</span> modprobe usbip-core</span><br><span class="line"><span class="built_in">sudo</span> modprobe vhci-hcd</span><br><span class="line"><span class="built_in">echo</span> $(<span class="built_in">cat</span> /etc/resolv.conf | grep nameserver | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>実行権限付与</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">sudo</span> <span class="built_in">chmod</span> +x startusb.sh</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>カーネルのコピー</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">cp</span> /usr/src/4.19.104-microsoft-standard/vmlinux /mnt/c/Users/&lt;username&gt;/</span><br></pre></td></tr></table></figure>

<h3 id="構築-Windows-10-1"><a href="#構築-Windows-10-1" class="headerlink" title="構築(Windows 10)"></a>構築(Windows 10)</h3><h4 id="WSL-のカーネルファイル指定"><a href="#WSL-のカーネルファイル指定" class="headerlink" title="WSL のカーネルファイル指定"></a>WSL のカーネルファイル指定</h4><ol>
<li>WSL のカーネル指定</li>
</ol>
<figure class="highlight ini"><figcaption><span>C:\Users\ユーザ名\.wslconfig</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="section">[WSL2]</span></span><br><span class="line"><span class="attr">kernel</span>=C:\\Users\\&lt;username&gt;\\vmlinux</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>WSL のシャットダウン(再起動)</li>
</ol>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line">&gt;wsl <span class="comment">--shutdown</span></span><br></pre></td></tr></table></figure>

<h3 id="構築-WSL-1"><a href="#構築-WSL-1" class="headerlink" title="構築(WSL)"></a>構築(WSL)</h3><h4 id="カーネルの確認とUSB-アクセス"><a href="#カーネルの確認とUSB-アクセス" class="headerlink" title="カーネルの確認とUSB アクセス"></a>カーネルの確認とUSB アクセス</h4><ol>
<li>カーネルの確認とUSB デバイスの参照</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">uname</span> -r -v</span><br><span class="line">4.19.104-microsoft-standard <span class="comment">#1 SMP Mon Jul 6 18:00:19 JST 2020</span></span><br><span class="line">$ ./startusb.sh</span><br><span class="line">$ <span class="built_in">sudo</span> usbip attach --remote=192.168.11.2 --busid=1-112</span><br><span class="line">$ <span class="built_in">sudo</span> dmesg</span><br><span class="line">$ lsusb</span><br><span class="line">Bus 002 Device 001: ID 1d6b:0003 Linux Foundation 3.0 root hub</span><br><span class="line">Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub</span><br></pre></td></tr></table></figure>
</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/wsl/">wsl</a><a class="post-meta__tags" href="/tags/usb/">usb</a></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2020/07/10/SheetUI/" title="SheetUI"><img class="cover" src="/images/sheetui.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">SheetUI</div></div><div class="info-2"><div class="info-item-1">https://sheetui.com/SheetUI でGoogle スプレッドシートのデータをWeb ページで可視化してみました。ARMORY ボタンでBlizzard の各キャラクタのページに遷移します。GUIDE ボタンで各キャラクタのクラス&#x2F;スペックに応じたWowHead ガイドに遷移します。   Google スプレッドシートの準備 Chrome のツールバーの「アプリ」を選択 「スプレッドシート」を開く 新しいスプレッドシートを作成「空白」を選択 データの登録        if (!window.google) {     document.body.innerHTML = 'You need to include the script //google.com/jsapi on your template';     throw 'Google JS API is needed';   } else {     (function() {       google.load('visualization', '1.0', {'packages': ["...</div></div></div></a><a class="pagination-related" href="/2020/07/02/Ray-tracing-in-Nim-on-WSL/" title="Ray tracing in Nim on WSL"><img class="cover" src="/images/trace-of-radiance.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">Ray tracing in Nim on WSL</div></div><div class="info-2"><div class="info-item-1">https://nim-lang.org/blog/2020/06/30/ray-tracing-in-nim.htmlWSL 上のNim 言語でレイトレースしてみました。   環境 Windows 10 Insider Preview Build 20161 WSL2 (Ubuntu 20.04 LTS) nim 1.2.4      構築WSL 側 nim のインストール    $ curl https://nim-lang.org/choosenim/init.sh -sSf | sh   $HOME/.profileexport PATH=$HOME/.nimble/bin:$PATH  clang のインストール    $ sudo apt install clang  利用Trace of Radiancehttps://github.com/mratsim/trace-of-radiance $ git clone https://github.com/mratsim/trace-of-radiance$ cd trace-of-radiance$ git chec...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2019/06/04/Chinachu-on-WSL/" title="WSL でChinachu"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2019-06-04</div><div class="info-item-2">WSL でChinachu</div></div><div class="info-2"><div class="info-item-1">https://github.com/Chinachu/Chinachu/wiki/Gamma-Installation-V2 Chinachu がWSL (Ubuntu 18.04)で普通に動きました。   現在の環境 Windows 10 Windows 10 でMirakurun を導入済 WSL (Ubuntu 18.04 が導入済でデフォルト)を導入済 WSL でnode.js を導入済  WSL でChinachu のインストール$ sudo apt-get install build-essential curl git-core vainfo$ sudo npm install pm2 -g$ sudo pm2 startup$ git clone git://github.com/kanreisa/Chinachu.git ~/chinachu$ cd ~/chinachu/$ ./chinachu installer$ cp config.sample.json config.json  ~&#x2F;chinachu&#x2F;config.json の設定...</div></div></div></a><a class="pagination-related" href="/2020/01/27/Puppeteer-on-WSL/" title="Puppeteer on WSL"><img class="cover" src="https://user-images.githubusercontent.com/10379601/29446482-04f7036a-841f-11e7-9872-91d1fc2ea683.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2020-01-27</div><div class="info-item-2">Puppeteer on WSL</div></div><div class="info-2"><div class="info-item-1">https://github.com/puppeteer/puppeteer/issues/1837 WSL のPuppeteer からWindows にインストールされたChrome(chrome.exe) を起動します。WSL 側にインストールするパッケージが少なくてすみそうです。   環境 WSL1(Ubuntu 18.04) on Windows 10 node v13.6.0 npm 6.13.4 puppeteer  構築node のインストール$ sudo apt update &amp;&amp; sudo apt upgrade$ sudo apt install nodejs npm$ sudo npm clean all$ sudo npm install n$ sudo n latest$ sudo ln -sf /usr/local/bin/node /usr/bin/node$ sudo apt purge nodejs npm$ sudo apt clean all$ sudo apt autoremove  puppeteer のインストール$ n...</div></div></div></a><a class="pagination-related" href="/2019/06/14/WSL2/" title="WSL 2"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2019-06-14</div><div class="info-item-2">WSL 2</div></div><div class="info-2"><div class="info-item-1">Windows Insider Program でWSL 2 が利用できるようになりましたので試してみました。 既存のWSL 環境をWSL 2 に変換しました。WSL 2 ではHyper-V を利用するようになったようですね。   1. Windows Insider Program へ登録https://insider.windows.com/ja-jp/上記のURL からWindows Insider Program に参加登録します。 2. Windows Update を実行Windows Update を実行すると以下の状態になりました。 エディション: Windows 10 Pro Insider Previewバージョン: 1903OSビルド: 18917.1000 3. VirtualMachinePlatform の有効化Windows PowerShell(管理者)モードから設定します。 PS C:\WINDOWS\system32&gt; Enable-WindowsOptionalFeature -Online -FeatureName VirtualMa...</div></div></div></a><a class="pagination-related" href="/2020/08/01/Enabling-sound-in-WSL/" title="Enabling sound in WSL"><img class="cover" src="/images/moc-on-wsl2.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2020-08-01</div><div class="info-item-2">Enabling sound in WSL</div></div><div class="info-2"><div class="info-item-1">https://x410.dev/cookbook/wsl/enabling-sound-in-wsl-ubuntu-let-it-sing/https://www.freedesktop.org/wiki/Software/PulseAudio/Ports/Windows/Support/ PulseAudio を使ってWSL2 上でサウンドを再生できるようにしてみました。Extraterm 上でMOC(Music on Console) を利用してみました。Visual Studio Code のターミナルでも実行できます。   環境 Windows 10 Insider Preview Build 20180 [IP: 192.168.11.2] PulseAudio for Windows 1.1 WSL2 (Ubuntu) pulseaudio 13.99.1 moc 2.6-alpha3 (Theme: transparent-background)   Extraterm 0.52.0 (Theme: Extraterm Default)    構築 (Window...</div></div></div></a><a class="pagination-related" href="/2022/02/08/Develop-Environment-on-WSL/" title="Development Environment on WSL"><img class="cover" src="/images/wsl-dev.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-08</div><div class="info-item-2">Development Environment on WSL</div></div><div class="info-2"><div class="info-item-1">https://github.com/coder/code-server WSL にこっそり開発環境を構築しようと思います。Microsoft Store が利用不可、インターネットアクセスに認証プロキシが存在する環境とします。 実現する機能 WSL2 (Ubuntu 20.04, systemd 有効化) Code Server (Web版Visual Studio Code)をPWA化 Code Server の拡張機能 Japanese Language Pack (日本語化) Project Manager Activitus Bar Draw.io (図形エディタ)   Gitea (Git リポジトリ管理) SliDev (スライド)    環境   項目 値    認証プロキシ環境 http://hoge:fuga@100.100.100.100:8080   ローカルホスト: OS Windows 10 Pro + WSL2   ローカルホスト: WSL WSL2 (Ubuntu 20.4)   ローカルホスト: Microsoft Store 利用不可   ロー...</div></div></div></a><a class="pagination-related" href="/2020/08/24/OpenVPN-on-WSL2/" title="OpenVPN on WSL2"><img class="cover" src="/images/openvpn_wsl.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2020-08-24</div><div class="info-item-2">OpenVPN on WSL2</div></div><div class="info-2"><div class="info-item-1">https://github.com/pritunl/pritunlWSL2 の環境にOpenVPN を導入してみました。Pritunl を管理ツールとして使いました。外出先から自宅環境のファイルサーバの参照、EPGStation の操作、WSL2 への接続、Windows 10 へのリモートデスクトップ接続、等ができます。今まではRaspberry Pi をVPN サーバにしていました。リスクがある気もしますが移行を検討してみます。   環境 Windows 10 Insider Preview Build 20197 WSL2 (Ubuntu 20.04) openvpn 2.4.7 pritunl 1.29.2530.72ℹ️Wireguard を指定する項目が増えていました mongodb 3.6.9     v6 プラスでインターネット接続   v6 プラス接続環境の調査 公開IPv4 アドレスと公開IPv6 アドレスを確認  https://test-ipv6.com/ 公開IPv6 アドレスから公開可能なポート番号を確認  http://ipv4.web.fc2.c...</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comments</span></div></div><div class="comment-wrap"><div><div id="utterances-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/images/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">ktkr3d</div><div class="author-info-description">Memorandum</div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">487</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">197</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">31</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/ktkr3d"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/ktkr3d" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="https://gist.github.com/ktkr3d" target="_blank" title="Gist"><i class="fas fa-code" style="color: #24292e;"></i></a><a class="social-icon" href="https://x.com/ktkr3d" target="_blank" title="X"><i class="fab fa-x-twitter" style="color: #24292e;"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%92%B0%E5%A2%83"><span class="toc-number">1.</span> <span class="toc-text">環境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A7%8B%E7%AF%89-Windows-10"><span class="toc-number">2.</span> <span class="toc-text">構築(Windows 10)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#USBIP-WIN-%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><span class="toc-number">2.1.</span> <span class="toc-text">USBIP-WIN のインストール</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A7%8B%E7%AF%89-WSL"><span class="toc-number">3.</span> <span class="toc-text">構築(WSL)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E3%82%AB%E3%83%BC%E3%83%8D%E3%83%AB%E3%81%AE%E3%83%93%E3%83%AB%E3%83%89"><span class="toc-number">3.1.</span> <span class="toc-text">カーネルのビルド</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A7%8B%E7%AF%89-Windows-10-1"><span class="toc-number">4.</span> <span class="toc-text">構築(Windows 10)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#WSL-%E3%81%AE%E3%82%AB%E3%83%BC%E3%83%8D%E3%83%AB%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E6%8C%87%E5%AE%9A"><span class="toc-number">4.1.</span> <span class="toc-text">WSL のカーネルファイル指定</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A7%8B%E7%AF%89-WSL-1"><span class="toc-number">5.</span> <span class="toc-text">構築(WSL)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E3%82%AB%E3%83%BC%E3%83%8D%E3%83%AB%E3%81%AE%E7%A2%BA%E8%AA%8D%E3%81%A8USB-%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9"><span class="toc-number">5.1.</span> <span class="toc-text">カーネルの確認とUSB アクセス</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/12/06/Faugus-Launcher/" title="Faugus Launcher">Faugus Launcher</a><time datetime="2025-12-06T06:14:20.000Z" title="Created 2025-12-06 15:14:20">2025-12-06</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/12/01/SDDM/" title="SDDM">SDDM</a><time datetime="2025-12-01T08:35:57.000Z" title="Created 2025-12-01 17:35:57">2025-12-01</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/11/30/Walker/" title="Walker">Walker</a><time datetime="2025-11-30T13:18:02.000Z" title="Created 2025-11-30 22:18:02">2025-11-30</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/11/29/CachyOS/" title="CachyOS">CachyOS</a><time datetime="2025-11-28T23:05:23.000Z" title="Created 2025-11-29 08:05:23">2025-11-29</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/11/17/Caelestia/" title="Caelestia">Caelestia</a><time datetime="2025-11-17T13:18:22.000Z" title="Created 2025-11-17 22:18:22">2025-11-17</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/images/travel.png);"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2010 - 2025 By ktkr3d</span><span class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 8.1.1</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.3</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="Scroll to Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const config = mermaidSrc.dataset.config ? JSON.parse(mermaidSrc.dataset.config) : {}
      if (!config.theme) {
        config.theme = theme
      }
      const mermaidThemeConfig = `%%{init: ${JSON.stringify(config)}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (true) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null
  const getUtterancesTheme = theme => theme === 'dark' ? 'photon-dark' : 'github-light'

  const loadUtterances = (el = document, key) => {
    if (isShuoshuo) {
      window.shuoshuoComment.destroyUtterances = () => {
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }

    const config = {
      src: 'https://utteranc.es/client.js',
      repo: 'ktkr3d/ktkr3d.github.io',
      theme: getUtterancesTheme(document.documentElement.getAttribute('data-theme')),
      crossorigin: 'anonymous',
      async: true,
      ...option,
      'issue-term': isShuoshuo ? key : (option && option['issue-term']) || 'pathname'
    }

    const ele = document.createElement('script')
    Object.entries(config).forEach(([key, value]) => ele.setAttribute(key, value))
    el.querySelector('#utterances-wrap').appendChild(ele)
  }

  const changeUtterancesTheme = theme => {
    const iframe = document.querySelector('#utterances-wrap iframe')
    if (iframe) {
      const message = {
        type: 'set-theme',
        theme: getUtterancesTheme(theme)
      };
      iframe.contentWindow.postMessage(message, 'https://utteranc.es')
    }
  }

  btf.addGlobalFn('themeChange', changeUtterancesTheme, 'utterances')

  if (isShuoshuo) {
    'Utterances' === 'Utterances'
      ? window.shuoshuoComment = { loadComment: loadUtterances }
      : window.loadOtherComment = loadUtterances
    return
  }
  
  if ('Utterances' === 'Utterances' || !false) {
    if (false) btf.loadComment(document.getElementById('utterances-wrap'), loadUtterances)
    else loadUtterances()
  } else {
    window.loadOtherComment = loadUtterances
  }
})()</script></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><i class="fas fa-spinner fa-pulse" id="loading-status" hidden="hidden"></i><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading Database</span></div><div class="local-search-input"><input placeholder="Search for Posts" type="text"/></div><hr/><div id="local-search-results"></div><div class="ais-Pagination" id="local-search-pagination" style="display:none;"><ul class="ais-Pagination-list"></ul></div><div id="local-search-stats"></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>