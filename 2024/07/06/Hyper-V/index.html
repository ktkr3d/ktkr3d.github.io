<!DOCTYPE html><html lang="jp" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Hyper-V | Memorandum!</title><meta name="author" content="ktkr3d"><meta name="copyright" content="ktkr3d"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="次のような制約のある環境でLinuxやVisual Studio Codeを使いたい場合にはHyper-Vを活用するとよいかもしれません。  Windows にWSL、VirtualboxやVisual Studio Code等を自由にインストールできない&#x2F;したくない インターネットへのアウトバウンド通信はブラウザでの認証が必要">
<meta property="og:type" content="article">
<meta property="og:title" content="Hyper-V">
<meta property="og:url" content="https://ktkr3d.github.io/2024/07/06/Hyper-V/index.html">
<meta property="og:site_name" content="Memorandum!">
<meta property="og:description" content="次のような制約のある環境でLinuxやVisual Studio Codeを使いたい場合にはHyper-Vを活用するとよいかもしれません。  Windows にWSL、VirtualboxやVisual Studio Code等を自由にインストールできない&#x2F;したくない インターネットへのアウトバウンド通信はブラウザでの認証が必要">
<meta property="og:locale">
<meta property="og:image" content="https://ktkr3d.github.io/images/hyperv.drawio.svg">
<meta property="article:published_time" content="2024-07-06T13:14:26.000Z">
<meta property="article:modified_time" content="2024-07-30T14:43:17.000Z">
<meta property="article:author" content="ktkr3d">
<meta property="article:tag" content="code-server">
<meta property="article:tag" content="hyperv">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://ktkr3d.github.io/images/hyperv.drawio.svg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Hyper-V",
  "url": "https://ktkr3d.github.io/2024/07/06/Hyper-V/",
  "image": "https://ktkr3d.github.io/images/hyperv.drawio.svg",
  "datePublished": "2024-07-06T13:14:26.000Z",
  "dateModified": "2024-07-30T14:43:17.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "ktkr3d",
      "url": "https://ktkr3d.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="/images/favicon.png"><link rel="canonical" href="https://ktkr3d.github.io/2024/07/06/Hyper-V/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-MG6LWTJBY0"></script><script>window.dataLayer = window.dataLayer || []
function gtag(){dataLayer.push(arguments)}
gtag('js', new Date())
gtag('config', 'G-MG6LWTJBY0')
btf.addGlobalFn('pjaxComplete', () => {
  gtag('config', 'G-MG6LWTJBY0', {'page_path': window.location.pathname})
}, 'google_analytics')
</script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"pagination":{"enable":false,"hitsPerPage":8},"languages":{"hits_empty":"No results found for: ${query}","hits_stats":"${hits} articles found"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":false,"highlightLang":false,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'medium_zoom',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: false,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Hyper-V',
  isHighlightShrink: undefined,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/css/custom.css"><script type="text/javascript" src="//www.google.com/jsapi"></script><meta name="generator" content="Hexo 8.1.1"><link rel="alternate" href="/rss.xml" title="Memorandum!" type="application/rss+xml">
</head><body><div class="bg-animation" id="web_bg" style="background-color: rgb(227, 233, 199);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/images/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">487</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">197</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">31</div></a></div><div class="menus_items"><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> Pages</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></li><li><a class="site-page child" href="/archlinux/"><i class="fa-fw fa-solid fa-a"></i><span> Arch Linux</span></a></li><li><a class="site-page child" href="/GNOME/"><i class="fa-fw fa-solid fa-g"></i><span> GNOME</span></a></li><li><a class="site-page child" href="/hexo/"><i class="fa-fw fa-solid fa-h"></i><span> Hexo</span></a></li><li><a class="site-page child" href="/To-Do/"><i class="fa-fw fa-solid fa-list"></i><span> To Do</span></a></li><li><a class="site-page child" href="/ubuntu/"><i class="fa-fw fa-brands fa-ubuntu"></i><span> Ubuntu</span></a></li><li><a class="site-page child" href="/Visual-Studio-Code/"><i class="fa-fw fa-solid fa-code"></i><span> Visual Studio Code</span></a></li><li><a class="site-page child" href="/World-of-Warcraft/"><i class="fa-fw fa-solid fa-gamepad"></i><span> World of Warcraft</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img fixed" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Memorandum!</span></a><a class="nav-page-title" href="/"><span class="site-name">Hyper-V</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  Back to Home</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></span></div><div class="menus_items"><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> Pages</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></li><li><a class="site-page child" href="/archlinux/"><i class="fa-fw fa-solid fa-a"></i><span> Arch Linux</span></a></li><li><a class="site-page child" href="/GNOME/"><i class="fa-fw fa-solid fa-g"></i><span> GNOME</span></a></li><li><a class="site-page child" href="/hexo/"><i class="fa-fw fa-solid fa-h"></i><span> Hexo</span></a></li><li><a class="site-page child" href="/To-Do/"><i class="fa-fw fa-solid fa-list"></i><span> To Do</span></a></li><li><a class="site-page child" href="/ubuntu/"><i class="fa-fw fa-brands fa-ubuntu"></i><span> Ubuntu</span></a></li><li><a class="site-page child" href="/Visual-Studio-Code/"><i class="fa-fw fa-solid fa-code"></i><span> Visual Studio Code</span></a></li><li><a class="site-page child" href="/World-of-Warcraft/"><i class="fa-fw fa-solid fa-gamepad"></i><span> World of Warcraft</span></a></li></ul></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">Hyper-V</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2024-07-06T13:14:26.000Z" title="Created 2024-07-06 22:14:26">2024-07-06</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2024-07-30T14:43:17.000Z" title="Updated 2024-07-30 23:43:17">2024-07-30</time></span></div><div class="meta-secondline"></div></div></div><article class="container post-content" id="article-container"><p><img src="/images/hyperv.drawio.svg"></p>
<p>次のような制約のある環境でLinuxやVisual Studio Codeを使いたい場合にはHyper-Vを活用するとよいかもしれません。</p>
<ul>
<li>Windows にWSL、VirtualboxやVisual Studio Code等を自由にインストールできない&#x2F;したくない</li>
<li>インターネットへのアウトバウンド通信はブラウザでの認証が必要</li>
</ul>
<span id="more"></span>

<h3 id="環境"><a href="#環境" class="headerlink" title="環境"></a>環境</h3><ul>
<li>Windows 11 Pro 21H2<ul>
<li>Hyper-V 10.0.22000.1</li>
<li>IIS 10.0.22000.2652</li>
</ul>
</li>
<li>Ubuntu 24.04 LTS (デスクトップ)<ul>
<li>mkcert 1.4.4</li>
<li>libnss3-tools 3.98</li>
<li>code-server v4.90.3</li>
</ul>
</li>
</ul>
<h3 id="構築"><a href="#構築" class="headerlink" title="構築"></a>構築</h3><p>Hyper-VでUbuntuの環境を構築して、ホストOSのブラウザからゲストOS上のcode-serverを利用します。</p>
<h4 id="ホストOS-Hyper-Vで仮想マシンを作成"><a href="#ホストOS-Hyper-Vで仮想マシンを作成" class="headerlink" title="ホストOS: Hyper-Vで仮想マシンを作成"></a>ホストOS: Hyper-Vで仮想マシンを作成</h4><ol>
<li>Hyper-VとIISを有効化<br>  <code>コントロールパネル</code> → <code>プログラムと機能</code> → <code>Widowsの機能の有効化または無効化</code> で以下を有効化</li>
</ol>
<ul>
<li>Hyper-V</li>
<li>インターネットインフォメーションサービス</li>
</ul>
<ol start="2">
<li>Hyper-Vに内部ネットワークの仮想スイッチを作成<br>  <code>Hyper-Vマネージャ</code> → <code>仮想スイッチマネージャ</code><br>  <code>内部</code>を選択して<code>仮想スイッチの作成</code><br>  名前を<code>Internal Switch</code>にしてOK<br>  169.254.0.0&#x2F;16 の仮想ネットワークが作成される</li>
<li>ホストOSのIPアドレスの確認</li>
</ol>
  <figure class="highlight dos"><table><tr><td class="code"><pre><span class="line"><span class="built_in">ipconfig</span></span><br></pre></td></tr></table></figure>
<ol start="4">
<li>UbuntuのISOファイルをダウンロード<br>  <a target="_blank" rel="noopener" href="https://ubuntu.com/download/desktop">https://ubuntu.com/download/desktop</a><br>  ubuntu-24.04-desktop-amd64.iso</li>
<li>Hyper-VでUbuntu用の仮想マシンを作成</li>
</ol>
<ul>
<li>仮想マシンの名前: “Ubuntu 24.04 LTS”</li>
<li>ネットワークの構成： <code>Internal Switch</code></li>
<li>インストールオプション: UbuntuのISOファイルを指定</li>
</ul>
<ol start="6">
<li>仮想マシンを起動</li>
</ol>
<h4 id="ゲストOS-Ubuntuをインストール"><a href="#ゲストOS-Ubuntuをインストール" class="headerlink" title="ゲストOS: Ubuntuをインストール"></a>ゲストOS: Ubuntuをインストール</h4><ol>
<li>Ubuntuをインストール</li>
<li>IPアドレスの固定化</li>
</ol>
<ul>
<li>Ubuntu Desktopの場合<br>設定 ネットワーク 有線 ギアアイコン IPv4<br>手動を選択<br>アドレス  169.254.0.1<br>ネットマスク 255.255.0.0<br>以下を追記(重要)<figure class="highlight yaml"><figcaption><span>/etc/netplan/90-NM-****.yaml</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="attr">network:</span></span><br><span class="line">  <span class="attr">ethernets:</span></span><br><span class="line">    <span class="attr">eth0:</span></span><br><span class="line">      <span class="attr">dhcp4:</span> <span class="literal">no</span></span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="3">
<li>追加パッケージファイル(mkcert, libnss3-tools, xrdp, xorgxrdp)のURL一覧の抽出</li>
</ol>
  <figure class="highlight bash"><figcaption><span>~/bash_aliases</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">deb</span></span> () &#123;</span><br><span class="line">  <span class="keyword">for</span> PKG <span class="keyword">in</span> $(apt rdepends <span class="variable">$1</span> | grep -v <span class="string">&quot;^ &quot;</span>);  <span class="keyword">do</span> <span class="built_in">sudo</span> apt reinstall --print-uris <span class="variable">$PKG</span> ; <span class="keyword">done</span> | grep <span class="string">&quot;http://&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">. ~/.bash_aliases</span><br><span class="line">deb mkcert</span><br><span class="line">deb libnss3-tools</span><br><span class="line">deb xrdp</span><br><span class="line">deb xorgxrdp</span><br></pre></td></tr></table></figure>
<p>  .debファイルのURLが出力される。</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://jp.archive.ubuntu.com/ubuntu/pool/universe/m/mkcert/mkcert_1.4.4-1ubuntu2_amd64.deb">http://jp.archive.ubuntu.com/ubuntu/pool/universe/m/mkcert/mkcert_1.4.4-1ubuntu2_amd64.deb</a></li>
<li><a target="_blank" rel="noopener" href="http://jp.archive.ubuntu.com/ubuntu/pool/main/n/nss/libnss3-tools_3.98-1build1_amd64.deb">http://jp.archive.ubuntu.com/ubuntu/pool/main/n/nss/libnss3-tools_3.98-1build1_amd64.deb</a></li>
<li><a target="_blank" rel="noopener" href="http://jp.archive.ubuntu.com/ubuntu/pool/universe/x/xrdp/xrdp_0.9.24-4_amd64.deb">http://jp.archive.ubuntu.com/ubuntu/pool/universe/x/xrdp/xrdp_0.9.24-4_amd64.deb</a></li>
<li><a target="_blank" rel="noopener" href="http://jp.archive.ubuntu.com/ubuntu/pool/universe/x/xorgxrdp/xorgxrdp_0.9.19-1_amd64.deb">http://jp.archive.ubuntu.com/ubuntu/pool/universe/x/xorgxrdp/xorgxrdp_0.9.19-1_amd64.deb</a></li>
</ul>
<h4 id="ホストOS-パッケージをダウンロード"><a href="#ホストOS-パッケージをダウンロード" class="headerlink" title="ホストOS: パッケージをダウンロード"></a>ホストOS: パッケージをダウンロード</h4><ol>
<li>ブラウザでパッケージファイルをダウンロード</li>
</ol>
<ul>
<li><a target="_blank" rel="noopener" href="http://jp.archive.ubuntu.com/ubuntu/pool/universe/m/mkcert/mkcert_1.4.4-1ubuntu2_amd64.deb">http://jp.archive.ubuntu.com/ubuntu/pool/universe/m/mkcert/mkcert_1.4.4-1ubuntu2_amd64.deb</a></li>
<li><a target="_blank" rel="noopener" href="http://jp.archive.ubuntu.com/ubuntu/pool/main/n/nss/libnss3-tools_3.98-1build1_amd64.deb">http://jp.archive.ubuntu.com/ubuntu/pool/main/n/nss/libnss3-tools_3.98-1build1_amd64.deb</a></li>
<li><a target="_blank" rel="noopener" href="http://jp.archive.ubuntu.com/ubuntu/pool/universe/x/xrdp/xrdp_0.9.24-4_amd64.deb">http://jp.archive.ubuntu.com/ubuntu/pool/universe/x/xrdp/xrdp_0.9.24-4_amd64.deb</a></li>
<li><a target="_blank" rel="noopener" href="http://jp.archive.ubuntu.com/ubuntu/pool/universe/x/xorgxrdp/xorgxrdp_0.9.19-1_amd64.deb">http://jp.archive.ubuntu.com/ubuntu/pool/universe/x/xorgxrdp/xorgxrdp_0.9.19-1_amd64.deb</a></li>
</ul>
<ol start="2">
<li>ブラウザでcode-server をダウンロード</li>
</ol>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/coder/code-server/releases">https://github.com/coder/code-server/releases</a><br>code-server_4.90.3_amd64.deb</li>
</ul>
<ol start="3">
<li>.debファイル群をpackages.zipに圧縮して、IISのドキュメントルートに配置</li>
</ol>
  <figure class="highlight avrasm"><table><tr><td class="code"><pre><span class="line"><span class="symbol">C:</span>\Inetpub\wwwroot\packages.zip</span><br></pre></td></tr></table></figure>

<h4 id="ゲストOS-パッケージをインストール"><a href="#ゲストOS-パッケージをインストール" class="headerlink" title="ゲストOS: パッケージをインストール"></a>ゲストOS: パッケージをインストール</h4><ol>
<li>パッケージファイルのアーカイブをダウンロードして展開</li>
</ol>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget http://169.254.xxx.xxx/packages.zip</span><br><span class="line">unzip packages.zip</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>パッケージをインストール</li>
</ol>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> packages</span><br><span class="line"><span class="built_in">sudo</span> dpkg -i *.deb</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>認証局を構築し、サーバ証明書を作成</li>
</ol>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mkcert -install</span><br></pre></td></tr></table></figure>
<p>  以下のファイルが生成される。</p>
<ul>
<li>&#x2F;home&#x2F;ubuntu&#x2F;.local&#x2F;share&#x2F;mkcert&#x2F;rootCA.pem</li>
<li>&#x2F;home&#x2F;ubuntu&#x2F;.local&#x2F;share&#x2F;mkcert&#x2F;rootCA-key.pem<br>  サーバ証明書の作成</li>
</ul>
  <figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">cd ~/.<span class="keyword">local</span>/<span class="keyword">share</span>/mkcert</span><br><span class="line">mkcert ubuntu.<span class="keyword">local</span></span><br></pre></td></tr></table></figure>
<p>  以下のファイルが生成される。</p>
<ul>
<li>&#x2F;home&#x2F;ubuntu&#x2F;.local&#x2F;share&#x2F;mkcert&#x2F;ubuntu.local.pem</li>
<li>&#x2F;home&#x2F;ubuntu&#x2F;.local&#x2F;share&#x2F;mkcert&#x2F;ubuntu.local-key.pem</li>
</ul>
<ol start="4">
<li>code-serverを設定して起動</li>
</ol>
  <figure class="highlight yaml"><figcaption><span>~/.config/code-server/config.yaml</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="comment">#bind-addr: 127.0.0.1:8080</span></span><br><span class="line"><span class="attr">bind-addr:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">:443</span></span><br><span class="line"><span class="comment">#auth: password</span></span><br><span class="line"><span class="attr">auth:</span> <span class="string">none</span></span><br><span class="line"><span class="attr">cert:</span> <span class="string">/home/ubuntu/.local/share/mkcert/ubuntu.local.pem</span></span><br><span class="line"><span class="attr">cert-key:</span> <span class="string">/home/ubuntu/.local/share/mkcert/ubuntu.local-key.pem</span></span><br></pre></td></tr></table></figure>
<p>  code-server に443&#x2F;tcp (1024以下のポート)へのバインドを許可<br>  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> <span class="built_in">setcap</span> cap_net_bind_service=+ep /usr/lib/code-server/lib/node</span><br></pre></td></tr></table></figure><br>  code-server の再起動<br>  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl <span class="built_in">enable</span> code-server@<span class="variable">$USER</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl restart code-server@<span class="variable">$USER</span></span><br></pre></td></tr></table></figure><br>5. xrdpの設定<br>  <figure class="highlight ini"><figcaption><span>/etc/xrdp/xrdp.ini</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="attr">port</span>=<span class="number">3389</span></span><br><span class="line"><span class="attr">port</span>=vsock://-<span class="number">1</span>:<span class="number">3389</span></span><br></pre></td></tr></table></figure><br>  <figure class="highlight bash"><figcaption><span>~/.profile</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> GNOME_SHELL_SESSION_MODE=ubuntu</span><br><span class="line"><span class="built_in">export</span> XDG_CURRENT_DESKTOP=ubuntu:GNOME</span><br></pre></td></tr></table></figure><br>  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl restart xrdp</span><br></pre></td></tr></table></figure></p>
<h4 id="ホストOS-拡張セッションの有効化とcode-serverのPWA化"><a href="#ホストOS-拡張セッションの有効化とcode-serverのPWA化" class="headerlink" title="ホストOS: 拡張セッションの有効化とcode-serverのPWA化"></a>ホストOS: 拡張セッションの有効化とcode-serverのPWA化</h4><ol>
<li>拡張セッションを有効化</li>
</ol>
  <figure class="highlight powershell"><figcaption><span>PowerShell</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="built_in">Set-VM</span> <span class="literal">-VMName</span> <span class="string">&quot;Ubuntu 24.04 LTS&quot;</span> <span class="literal">-EnhancedSessionTransportType</span> HvSocket</span><br></pre></td></tr></table></figure>
<ol>
<li>hosts の編集</li>
</ol>
  <figure class="highlight txt"><figcaption><span>C:\Windows\system32\drivers\etc\hosts</span></figcaption><table><tr><td class="code"><pre><span class="line">169.254.0.1  ubuntu.local</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>ブラウザで<code>https://ubuntu.local</code>にアクセス</li>
<li>code-serverのエクスプローラーまたはファイルマネージャでルート証明書をダウンロード</li>
</ol>
  <figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">~<span class="regexp">/.local/</span>share<span class="regexp">/mkcert/</span>rootCA.pem</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>ルート証明書をブラウザにインポート</li>
<li>ブラウザをリロードしてPWA化</li>
<li>Hyper-Vマネージャ → 自動開始アクション</li>
</ol>
<ul>
<li>常にこの仮想マシンを自動的に起動する: オン</li>
<li>起動待ち時間: 120秒</li>
</ul>
<h3 id="利用"><a href="#利用" class="headerlink" title="利用"></a>利用</h3><h4 id="Ubuntu-デスクトップの利用"><a href="#Ubuntu-デスクトップの利用" class="headerlink" title="Ubuntu デスクトップの利用"></a>Ubuntu デスクトップの利用</h4><ul>
<li>仮想マシンのショートカットから起動する場合<br>ショートカットを作成する。<br>リンク先: <code>C:\Windows\System32\vmconnect.exe 127.0.0.1 &quot;Ubuntu 24.04 LTS&quot;</code><br>ショートカットを右クリックして管理者として起動する</li>
<li>Hyper-V マネージャから起動する場合<br>Hyper-VマネージャでVMを右クリックして「接続」</li>
</ul>
<h4 id="code-server-の利用"><a href="#code-server-の利用" class="headerlink" title="code-server の利用"></a>code-server の利用</h4><p>PWA化したcode-serverアプリケーションを起動する。</p>
<ul>
<li>code-serverのターミナルでコマンドの実行</li>
<li>code-serverのエクスプローラーでファイルのアップロード&#x2F;ダウンロードが可能</li>
</ul>
<h4 id="Node-js-を利用する場合"><a href="#Node-js-を利用する場合" class="headerlink" title="Node.js を利用する場合"></a>Node.js を利用する場合</h4><ol>
<li>ホストOSでバイナリをダウンロード<br>  <a target="_blank" rel="noopener" href="https://nodejs.org/en/download/prebuilt-binaries">https://nodejs.org/en/download/prebuilt-binaries</a><br>  Node.js のバージョンを指定、Linuxを指定、x64を指定してダウンロード</li>
<li>ゲストOSに転送後、アーカイブを展開する</li>
</ol>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tar xvf *.tar.xz</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>&#x2F;usr&#x2F;local にコピーする</li>
</ol>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> <span class="built_in">cp</span> -r ./&#123;lib,share.include.bin&#125; /usr/local</span><br></pre></td></tr></table></figure>

<h4 id="Visual-Studio-Code-拡張を利用する場合"><a href="#Visual-Studio-Code-拡張を利用する場合" class="headerlink" title="Visual Studio Code 拡張を利用する場合"></a>Visual Studio Code 拡張を利用する場合</h4><ol>
<li>Visusal Studio マーケットプレース( <a target="_blank" rel="noopener" href="https://marketplace.visualstudio.com/vscode">https://marketplace.visualstudio.com/vscode</a> )から拡張機能のファイル(.vsix)をダウンロード</li>
<li>code-server で拡張機能をインストール<br>  <code>拡張</code> → <code>...</code> → <code>VSIXからのインストール</code><br>  .vsix ファイルを選択</li>
<li>code-serverの環境設定</li>
</ol>
</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/code-server/">code-server</a><a class="post-meta__tags" href="/tags/hyperv/">hyperv</a></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2024/07/23/mutter-text-input-v1/" title="mutter-text-input-v1"><img class="cover" src="/images/mutter-text-input-v1.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">mutter-text-input-v1</div></div><div class="info-2"><div class="info-item-1"> WaylandモードのGoogle Chrome&#x2F;Visual Studio Codeで日本語入力ができるようになりました。私はWaylandの分数スケーリング(Fractional Scaling)設定を利用していますので大変助かりました。 https://aur.archlinux.org/packages/mutter-text-input-v1   問題WaylandコンポジタのMutterがサポートしているtext-input-v3 とChome&#x2F;Electronがサポートしているtext-input-v1 のバージョンが異なることに起因してWaylandモードのChrome&#x2F;Electronで日本語入力できない問題がありました。  Ozone&#x2F;Wayland: Stabilizing IMEhttps://docs.google.com/document/d/1GkOphcAQBMdW4iPiMOd9eKd70tlXWQaR7M3GJXGUDpQ/edit#heading=h.7nki9mck5t64  この問題解決に向けて2...</div></div></div></a><a class="pagination-related" href="/2024/07/01/Minibook-X-Ubuntu-24-04-LTS/" title="Minibook X + Ubuntu 24.04 LTS"><img class="cover" src="/images/ubuntu-24-04.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">Minibook X + Ubuntu 24.04 LTS</div></div><div class="info-2"><div class="info-item-1"> Minibook X にUbuntu 24.04 LTS を導入してみました。ブラウザにはWaylandと相性のよいFirefoxを選択しました。PWAに対応したかったのでSnapは削除しました。タッチスクリーンで操作しやすいようにタスクバーを右側に配置し、GNOME Shellのタイリング拡張を導入しました。   環境 CHUWI Minibook X N100 (US配列キーボード) Ubuntu 24.04 LTS GNOME Shell 46 Firefox 127.0.2 Kodi 20.5.0 Visual Studio Code 1.90.2  構築 Ventoy を導入したUSBメモリにUbuntu 24.04 LTS のISOファイルを格納する。   https://www.ventoy.net/en/index.html https://ubuntu.com/download/desktop   USBメモリで起動し、gpartedでMiniBook X のストレージにUbuntu用のパーティションを作成する。画面が傾いているのでディスプレイの設定を変更する...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2023/02/27/code-server-with-SSL/" title="code-server with SSL"><img class="cover" src="/images/code-server-with-ssl.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-02-27</div><div class="info-item-2">code-server with SSL</div></div><div class="info-2"><div class="info-item-1">https://coder.com/docs/code-server/latest/guide#using-a-self-signed-certificateRaspberry Pi 上のcode-server でSSL通信を有効にしてみました。  Webアプリ(PWA)としてのインストールは問題ありませんでした。 Draw.ioは問題なく表示できました。 vscode-revealのプレビューはブラウザ表示ボタンで動作しました。    環境 Raspberry Pi 4B Ubuntu 23.04 code-server 4.10.0 mkcert 1.4.4  各種パラメタ ユーザ名ubuntu サーバ名ホスト名はubuntuで、リモートからubuntu.localでアクセス可能 CA ディレクトリ兼証明書用ディレクトリ/home/ubuntu/.local/share/mkcert/ code-server 設定ファイル/home/ubuntu/.config/code-server/config.yaml  通信 Protocol  TLS 1.3 Key exchang...</div></div></div></a><a class="pagination-related" href="/2022/10/22/Windows-11-WSL-2-systemd/" title="Windows 11 - WSL 2 - systemd"><img class="cover" src="/images/wsl2_systemd.drawio.svg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-22</div><div class="info-item-2">Windows 11 - WSL 2 - systemd</div></div><div class="info-2"><div class="info-item-1"> Windows 11 のWSL でsystemd を有効にしてみました。構成がすっきりしました。   環境まず、現在PC で構築しているサービスを整理します。 WSL で構築するサービス Pritunl (VPN、systemd で起動管理) Code-server (IDE、systemd で起動管理) Hexo (Blog、コマンドで実行)  Windows で構築するサービス EPGStation (番組表&#x2F;番組予約) Mirakurun (チューナ)  WSL 構築 systemd の有効化   設定/etc/wsl.conf[boot]systemd=true 一旦、WSL をシャットダウン(or 対象ディストリビューションをターミネート)   ポートフォワードの設定   PowerShell スクリプトwsl-proxy.ps1$WSL2_IPV4=bash -c &quot;ip route | grep &#x27;eth0 proto kernel scope&#x27; | cut -d &#x27; &#x27; -f9&quot;$HOST_I...</div></div></div></a><a class="pagination-related" href="/2022/10/25/code-server-vscode-reveal/" title="code-server + vscode-reveal"><img class="cover" src="/images/vscode-reveal.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-25</div><div class="info-item-2">code-server + vscode-reveal</div></div><div class="info-2"><div class="info-item-1"> code-server とvscode-reveal 拡張を組み合わせて利用してみました。 vscode-reveal はクライアント毎にポート番号を自動で生成します。ローカルPC上で利用する場合は問題ありませんが、リモートPCから利用する場合はポート番号が毎回変動してしまうため、PC間のポリシー許可設定が変動して面倒です。 reveal.js 本体はポート番号を指定可能ですが、残念ながらvscode-reveal にはポート番号を指定する設定項目がありませんでした。 調べたところ、vscode-reveal がlisten を開始する処理内でポート番号を固定に設定することでリモートから同じポート番号でアクセスできるようになりました。なお、ポート番号を1つに固定するため、複数のクライアントに対応できません。1つのクライアントからのアクセスのみが有効です。   構築 vscode-reveal (reveal.js) で利用するポート番号(例えば 43039)を決めます。   FW でポート番号43039の受信を許可します   vscode-reveal でreveal.js の...</div></div></div></a><a class="pagination-related" href="/2022/02/08/Develop-Environment-on-WSL/" title="Development Environment on WSL"><img class="cover" src="/images/wsl-dev.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-08</div><div class="info-item-2">Development Environment on WSL</div></div><div class="info-2"><div class="info-item-1">https://github.com/coder/code-server WSL にこっそり開発環境を構築しようと思います。Microsoft Store が利用不可、インターネットアクセスに認証プロキシが存在する環境とします。 実現する機能 WSL2 (Ubuntu 20.04, systemd 有効化) Code Server (Web版Visual Studio Code)をPWA化 Code Server の拡張機能 Japanese Language Pack (日本語化) Project Manager Activitus Bar Draw.io (図形エディタ)   Gitea (Git リポジトリ管理) SliDev (スライド)    環境   項目 値    認証プロキシ環境 http://hoge:fuga@100.100.100.100:8080   ローカルホスト: OS Windows 10 Pro + WSL2   ローカルホスト: WSL WSL2 (Ubuntu 20.4)   ローカルホスト: Microsoft Store 利用不可   ロー...</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comments</span></div></div><div class="comment-wrap"><div><div id="utterances-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/images/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">ktkr3d</div><div class="author-info-description">Memorandum</div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">487</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">197</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">31</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/ktkr3d"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/ktkr3d" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="https://gist.github.com/ktkr3d" target="_blank" title="Gist"><i class="fas fa-code" style="color: #24292e;"></i></a><a class="social-icon" href="https://x.com/ktkr3d" target="_blank" title="X"><i class="fab fa-x-twitter" style="color: #24292e;"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%92%B0%E5%A2%83"><span class="toc-number">1.</span> <span class="toc-text">環境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A7%8B%E7%AF%89"><span class="toc-number">2.</span> <span class="toc-text">構築</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E3%83%9B%E3%82%B9%E3%83%88OS-Hyper-V%E3%81%A7%E4%BB%AE%E6%83%B3%E3%83%9E%E3%82%B7%E3%83%B3%E3%82%92%E4%BD%9C%E6%88%90"><span class="toc-number">2.1.</span> <span class="toc-text">ホストOS: Hyper-Vで仮想マシンを作成</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E3%82%B2%E3%82%B9%E3%83%88OS-Ubuntu%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><span class="toc-number">2.2.</span> <span class="toc-text">ゲストOS: Ubuntuをインストール</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E3%83%9B%E3%82%B9%E3%83%88OS-%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%82%92%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89"><span class="toc-number">2.3.</span> <span class="toc-text">ホストOS: パッケージをダウンロード</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E3%82%B2%E3%82%B9%E3%83%88OS-%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><span class="toc-number">2.4.</span> <span class="toc-text">ゲストOS: パッケージをインストール</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E3%83%9B%E3%82%B9%E3%83%88OS-%E6%8B%A1%E5%BC%B5%E3%82%BB%E3%83%83%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E6%9C%89%E5%8A%B9%E5%8C%96%E3%81%A8code-server%E3%81%AEPWA%E5%8C%96"><span class="toc-number">2.5.</span> <span class="toc-text">ホストOS: 拡張セッションの有効化とcode-serverのPWA化</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8"><span class="toc-number">3.</span> <span class="toc-text">利用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Ubuntu-%E3%83%87%E3%82%B9%E3%82%AF%E3%83%88%E3%83%83%E3%83%97%E3%81%AE%E5%88%A9%E7%94%A8"><span class="toc-number">3.1.</span> <span class="toc-text">Ubuntu デスクトップの利用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#code-server-%E3%81%AE%E5%88%A9%E7%94%A8"><span class="toc-number">3.2.</span> <span class="toc-text">code-server の利用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Node-js-%E3%82%92%E5%88%A9%E7%94%A8%E3%81%99%E3%82%8B%E5%A0%B4%E5%90%88"><span class="toc-number">3.3.</span> <span class="toc-text">Node.js を利用する場合</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Visual-Studio-Code-%E6%8B%A1%E5%BC%B5%E3%82%92%E5%88%A9%E7%94%A8%E3%81%99%E3%82%8B%E5%A0%B4%E5%90%88"><span class="toc-number">3.4.</span> <span class="toc-text">Visual Studio Code 拡張を利用する場合</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/12/06/Faugus-Launcher/" title="Faugus Launcher">Faugus Launcher</a><time datetime="2025-12-06T06:14:20.000Z" title="Created 2025-12-06 15:14:20">2025-12-06</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/12/01/SDDM/" title="SDDM">SDDM</a><time datetime="2025-12-01T08:35:57.000Z" title="Created 2025-12-01 17:35:57">2025-12-01</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/11/30/Walker/" title="Walker">Walker</a><time datetime="2025-11-30T13:18:02.000Z" title="Created 2025-11-30 22:18:02">2025-11-30</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/11/29/CachyOS/" title="CachyOS">CachyOS</a><time datetime="2025-11-28T23:05:23.000Z" title="Created 2025-11-29 08:05:23">2025-11-29</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/11/17/Caelestia/" title="Caelestia">Caelestia</a><time datetime="2025-11-17T13:18:22.000Z" title="Created 2025-11-17 22:18:22">2025-11-17</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/images/travel.png);"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2010 - 2025 By ktkr3d</span><span class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 8.1.1</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.3</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="Scroll to Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const config = mermaidSrc.dataset.config ? JSON.parse(mermaidSrc.dataset.config) : {}
      if (!config.theme) {
        config.theme = theme
      }
      const mermaidThemeConfig = `%%{init: ${JSON.stringify(config)}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (true) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null
  const getUtterancesTheme = theme => theme === 'dark' ? 'photon-dark' : 'github-light'

  const loadUtterances = (el = document, key) => {
    if (isShuoshuo) {
      window.shuoshuoComment.destroyUtterances = () => {
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }

    const config = {
      src: 'https://utteranc.es/client.js',
      repo: 'ktkr3d/ktkr3d.github.io',
      theme: getUtterancesTheme(document.documentElement.getAttribute('data-theme')),
      crossorigin: 'anonymous',
      async: true,
      ...option,
      'issue-term': isShuoshuo ? key : (option && option['issue-term']) || 'pathname'
    }

    const ele = document.createElement('script')
    Object.entries(config).forEach(([key, value]) => ele.setAttribute(key, value))
    el.querySelector('#utterances-wrap').appendChild(ele)
  }

  const changeUtterancesTheme = theme => {
    const iframe = document.querySelector('#utterances-wrap iframe')
    if (iframe) {
      const message = {
        type: 'set-theme',
        theme: getUtterancesTheme(theme)
      };
      iframe.contentWindow.postMessage(message, 'https://utteranc.es')
    }
  }

  btf.addGlobalFn('themeChange', changeUtterancesTheme, 'utterances')

  if (isShuoshuo) {
    'Utterances' === 'Utterances'
      ? window.shuoshuoComment = { loadComment: loadUtterances }
      : window.loadOtherComment = loadUtterances
    return
  }
  
  if ('Utterances' === 'Utterances' || !false) {
    if (false) btf.loadComment(document.getElementById('utterances-wrap'), loadUtterances)
    else loadUtterances()
  } else {
    window.loadOtherComment = loadUtterances
  }
})()</script></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><i class="fas fa-spinner fa-pulse" id="loading-status" hidden="hidden"></i><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading Database</span></div><div class="local-search-input"><input placeholder="Search for Posts" type="text"/></div><hr/><div id="local-search-results"></div><div class="ais-Pagination" id="local-search-pagination" style="display:none;"><ul class="ais-Pagination-list"></ul></div><div id="local-search-stats"></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>